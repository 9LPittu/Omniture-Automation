
#megatemplate PDP validation queries
jcdp.browsebyquery = select email_address,URL,ProductName from (select email_address ,br_product_url_1,br_product_url_2, br_product_url_3, br_product_name_1, br_product_name_2, br_product_name_3 from (select email_address ,br_product_url_1,br_product_url_2, br_product_url_3, br_product_name_1, br_product_name_2, br_product_name_3 ,ROW_NUMBER()over(partition by br_product_url_1,br_product_url_2, br_product_url_3 order by email_address) rno from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where ((br_product_url_1 is not NULL) and (br_product_url_2 is not null) and (br_product_url_3 is not null)) ) t WHERE t.rno =1 and rownum < 6) t2 UnPivot((URL,ProductName) for sk in ((br_product_url_1,br_product_name_1) as 1,(br_product_url_2,br_product_name_2) as 2,(br_product_url_3,br_product_name_3) as 3)) order by email_address, sk
jcdp.newlyaddedquery = select email_address,URL,ProductName from (select email_address ,na_product_url_1,na_product_url_2, na_product_url_3, na_product_name_1, na_product_name_2, na_product_name_3 from (select email_address ,na_product_url_1,na_product_url_2, na_product_url_3, na_product_name_1, na_product_name_2, na_product_name_3,ROW_NUMBER()over(partition by na_product_url_1,na_product_url_2, na_product_url_3 order by email_address) rno from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where ((na_product_url_1 is not NULL) and (na_product_url_2 is not null) and (na_product_url_3 is not null)) ) t WHERE t.rno =1 and rownum < 6) t2 UnPivot((URL,ProductName) for sk in ((na_product_url_1,na_product_name_1) as 1,(na_product_url_2,na_product_name_2) as 2,(na_product_url_3,na_product_name_3) as 3)) order by email_address, sk
jcdp.famousareaquery = select email_address,URL,ProductName from (select email_address ,pa_product_url_1,pa_product_url_2, pa_product_url_3, pa_product_name_1, pa_product_name_2, pa_product_name_3 from (select email_address ,pa_product_url_1,pa_product_url_2, pa_product_url_3, pa_product_name_1, pa_product_name_2, pa_product_name_3 ,ROW_NUMBER()over(partition by pa_product_url_1,pa_product_url_2, pa_product_url_3 order by email_address) rno from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where ((pa_product_url_1 is not NULL) and (pa_product_url_2 is not null) and (pa_product_url_3 is not null)) ) t WHERE t.rno =1 and rownum < 6) t2 UnPivot((URL,ProductName) for sk in ((pa_product_url_1,pa_product_name_1) as 1,(pa_product_url_2,pa_product_name_2) as 2,(pa_product_url_3,pa_product_name_3) as 3)) order by email_address, sk
jcdp.topratedquery = Select email_address,URL,ProductName from (select email_address ,tr_product_url_1,tr_product_url_2, tr_product_url_3, tr_product_name_1, tr_product_name_2, tr_product_name_3 from (select email_address ,tr_product_url_1,tr_product_url_2, tr_product_url_3, tr_product_name_1, tr_product_name_2, tr_product_name_3 ,ROW_NUMBER()over(partition by tr_product_url_1,tr_product_url_2, tr_product_url_3 order by email_address) rno from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where ((tr_product_url_1 is not NULL) and (tr_product_url_2 is not null) and (tr_product_url_3 is not null)) ) t WHERE t.rno =1 and rownum < 6) t2 UnPivot((URL,ProductName) for sk in ((tr_product_url_1,tr_product_name_1) as 1,(tr_product_url_2,tr_product_name_2) as 2,(tr_product_url_3,tr_product_name_3) as 3)) order by email_address, sk

#extended megatemplate SQL queries
jcdp.extendedFamousAreaQuery = Select pa_product_NAME_1, pa_product_URL_1,pa_product_NAME_1 from \
(select distinct pa_product_NAME_1, pa_product_URL_1 from emaildb.pers_mega_pa_single_file \
union select distinct pa_product_NAME_2, pa_product_URL_2 from emaildb.pers_mega_pa_single_file \
union select distinct pa_product_NAME_3, pa_product_URL_3 from emaildb.pers_mega_pa_single_file) TEMPTABLE \
where lower(pa_product_NAME_1) like '% tall%' or lower(pa_product_NAME_1) like '%tall %' \
or lower(pa_product_NAME_1) like '% petite%' or lower(pa_product_NAME_1) like '%petite %'
jcdp.extendedTopRatedQuery = Select tr_product_NAME_1, tr_product_URL_1,tr_product_NAME_1 from \
(select distinct tr_product_NAME_1, tr_product_URL_1 from emaildb.pers_mega_tr_single_file \
union select distinct tr_product_NAME_2, tr_product_URL_2 from emaildb.pers_mega_tr_single_file \
union select distinct tr_product_NAME_3, tr_product_URL_3 from emaildb.pers_mega_tr_single_file) TEMPTABLE \
where lower(tr_product_NAME_1) like '% tall%' or lower(tr_product_NAME_1) like '%tall %' \
or lower(tr_product_NAME_1) like '% petite%' or lower(tr_product_NAME_1) like '%petite %'
jcdp.extendedNewArrivalQuery = Select na_product_NAME_1, na_product_URL_1,na_product_NAME_1 from \
(select distinct na_product_NAME_1, na_product_URL_1 from emaildb.pers_mega_na_single_file \
union select distinct na_product_NAME_2, na_product_URL_2 from emaildb.pers_mega_na_single_file \
union select distinct na_product_NAME_3, na_product_URL_3 from emaildb.pers_mega_na_single_file) TEMPTABLE \
where lower(na_product_NAME_1) like '% tall%' or lower(na_product_NAME_1) like '%tall %' \
or lower(na_product_NAME_1) like '% petite%' or lower(na_product_NAME_1) like '%petite %'

#feed validations SQL queries
jcdp.feedCartWishlistmaxmumQuery= Select email_address,cw_user_url_1,cw_user_url_2,cw_user_url_3,cw_user_url_4, \
cw_short_description_1,cw_short_description_2,cw_short_description_3,cw_short_description_4, \
cw_sku_size_1,cw_sku_size_2,cw_sku_size_3,cw_sku_size_4, \
cw_product_url_1,cw_product_url_2,cw_product_url_3,cw_product_url_4, \
cw_image_url_1,cw_image_url_2,cw_image_url_3,cw_image_url_4, \
cw_status_change_msg_1,cw_status_change_msg_2,cw_status_change_msg_3,cw_status_change_msg_4, \
cw_sent_type_1,cw_sent_type_2,cw_sent_type_3,cw_sent_type_4 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where (cw_user_url_1 is not null or cw_short_description_1 is not null or cw_sku_size_1 is not null or cw_product_url_1 is not null or cw_image_url_1 is not null or cw_status_change_msg_1 is not null or cw_sent_type_1 is not null) \
and (cw_user_url_1 is null or cw_short_description_1 is null or cw_sku_size_1 is null or cw_product_url_1 is null or cw_image_url_1 is null or cw_sent_type_1 is null) \
union all \
Select email_address,cw_user_url_1,cw_user_url_2,cw_user_url_3,cw_user_url_4, \
cw_short_description_1,cw_short_description_2,cw_short_description_3,cw_short_description_4, \
cw_sku_size_1,cw_sku_size_2,cw_sku_size_3,cw_sku_size_4, \
cw_product_url_1,cw_product_url_2,cw_product_url_3,cw_product_url_4, \
cw_image_url_1,cw_image_url_2,cw_image_url_3,cw_image_url_4, \
cw_status_change_msg_1,cw_status_change_msg_2,cw_status_change_msg_3,cw_status_change_msg_4, \
cw_sent_type_1,cw_sent_type_2,cw_sent_type_3,cw_sent_type_4 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where (cw_user_url_2 is not null or cw_short_description_2 is not null or cw_sku_size_2 is not null or cw_product_url_2 is not null or cw_image_url_2 is not null or cw_status_change_msg_2 is not null or cw_sent_type_2 is not null) \
and (cw_user_url_2 is null or cw_short_description_2 is null or cw_sku_size_2 is null or cw_product_url_2 is null or cw_image_url_2 is null or cw_sent_type_2 is null) \
union all \
Select email_address,cw_user_url_1,cw_user_url_2,cw_user_url_3,cw_user_url_4, \
cw_short_description_1,cw_short_description_2,cw_short_description_3,cw_short_description_4, \
cw_sku_size_1,cw_sku_size_2,cw_sku_size_3,cw_sku_size_4, \
cw_product_url_1,cw_product_url_2,cw_product_url_3,cw_product_url_4, \
cw_image_url_1,cw_image_url_2,cw_image_url_3,cw_image_url_4, \
cw_status_change_msg_1,cw_status_change_msg_2,cw_status_change_msg_3,cw_status_change_msg_4, \
cw_sent_type_1,cw_sent_type_2,cw_sent_type_3,cw_sent_type_4 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where (cw_user_url_3 is not null or cw_short_description_3 is not null or cw_sku_size_3 is not null or cw_product_url_3 is not null or cw_image_url_3 is not null or cw_status_change_msg_3 is not null or cw_sent_type_3 is not null) \
and (cw_user_url_3 is null or cw_short_description_3 is null or cw_sku_size_3 is null or cw_product_url_3 is null or cw_image_url_3 is null or cw_sent_type_3 is null) \
union all \
Select email_address,cw_user_url_1,cw_user_url_2,cw_user_url_3,cw_user_url_4, \
cw_short_description_1,cw_short_description_2,cw_short_description_3,cw_short_description_4, \
cw_sku_size_1,cw_sku_size_2,cw_sku_size_3,cw_sku_size_4, \
cw_product_url_1,cw_product_url_2,cw_product_url_3,cw_product_url_4, \
cw_image_url_1,cw_image_url_2,cw_image_url_3,cw_image_url_4, \
cw_status_change_msg_1,cw_status_change_msg_2,cw_status_change_msg_3,cw_status_change_msg_4, \
cw_sent_type_1,cw_sent_type_2,cw_sent_type_3,cw_sent_type_4 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where (cw_user_url_4 is not null or cw_short_description_4 is not null or cw_sku_size_4 is not null or cw_product_url_4 is not null or cw_image_url_4 is not null or cw_status_change_msg_4 is not null or cw_sent_type_4 is not null) \
and (cw_user_url_4 is null or cw_short_description_4 is null or cw_sku_size_4 is null or cw_product_url_4 is null or cw_image_url_4 is null or cw_sent_type_4 is null)

jcdp.feedCartWishlistDupProductQuery=Select email_address, ProductURL, psize, count(*) from \
(Select email_address, ProductURL,psize \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot ((ProductURL,psize) for sk in ((cw_product_url_1,cw_sku_size_1) as 1, \
(Cw_product_url_2,cw_sku_size_2) as 2, \
(cw_product_url_3,cw_sku_size_3) as 3,  \
(cw_product_url_4,cw_sku_size_4) as 4)) \
) TAB1 \
group by email_address, ProductURL, psize \
having count(*) > 1

jcdp.feedCartWishlistURLFormatQuery=select email_address, cw_user_url_1, cw_user_url_2, cw_user_url_3, cw_user_url_4 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where not ( \
(lower(cw_user_url_1) like 'https://www.jcrew.com/bag%' or lower(cw_user_url_1) like 'https://www.jcrew.com/wishlist%') \
and (lower(cw_user_url_2) like 'https://www.jcrew.com/bag%' or lower(cw_user_url_2) like 'https://www.jcrew.com/wishlist%') \
and (lower(cw_user_url_3) like 'https://www.jcrew.com/bag%' or lower(cw_user_url_3) like 'https://www.jcrew.com/wishlist%') \
and (lower(cw_user_url_4) like 'https://www.jcrew.com/bag%' or lower(cw_user_url_4) like 'https://www.jcrew.com/wishlist%') \
)

jcdp.feedCartWishlistBagFirstQuery=select email_address,max(case when producttype = 'CART' then pkey end) , min(case when producttype = 'WISH' then pkey end) \
from \
( \
select email_address,producttype,status,url,psize,pkey, \
case producttype when 'CART' then coalesce(cart.updated_amt,cart.original_amt,0) \
when 'WISH' then coalesce(wishlist.updated_amt,wishlist.original_amt,0) end price, \
case producttype when 'CART' then cart.create_dt \
when 'WISH' then wishlist.create_dt end effective_from, \
case status when 'LOW_INVENTORY' then 1 \
when 'BACK_IN_STOCK' THEN 2 \
when 'NOW_ON_SALE'then 3 \
else 4 end desired \
from (Select email_address,producttype,status,url,psize,pkey \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot INCLUDE NULLS ((producttype,status,url,psize) \
for pkey in ( (cw_sent_type_1,cw_status_change_msg_1,cw_product_url_1,cw_sku_size_1) as 1 \
,(cw_sent_type_2,cw_status_change_msg_2,cw_product_url_2,cw_sku_size_2) as 2 \
,(cw_sent_type_3,cw_status_change_msg_3,cw_product_url_3,cw_sku_size_3) as 3 \
,(cw_sent_type_4,cw_status_change_msg_4,cw_product_url_4,cw_sku_size_4) as 4))u) dataset \
left join emaildb.pers_cart_notification cart on cart.product_url = dataset.url \
and dataset.psize = cart.sku_size and producttype = 'CART' \
and dataset.email_address = cart.usa_email \
left join emaildb.pers_wishlist_notification wishlist on wishlist.product_url = dataset.url \
and dataset.psize = wishlist.sku_size and producttype = 'WISH' \
and dataset.email_address = wishlist.usa_email \
where coalesce(producttype,status,url,psize,'<NA>') != '<NA>' \
) TABA \
group by email_address \
having max(case when producttype = 'CART' then pkey end) > min(case when producttype = 'WISH' then pkey end)


jcdp.feedCartWishlistBagSortingQuery=select DISTINCT email_address  from \
(select  email_address,producttype,status,psize, price, effective_from \
,desired \
,to_char(effective_from,'DD-Mon-YYYY HH24:MI') \
,pkey \
,rank() OVER(PARTITION BY email_address ORDER BY desired,to_date(to_char(effective_from,'DD-Mon-YYYY'),'DD-Mon-YYYY') desc,price desc,pkey asc) test_rank \
,min(pkey) over(partition by email_address,producttype) mpkey \
from \
(select email_address,producttype,status,url,psize,pkey, \
case producttype when 'CART' then coalesce(cart.updated_amt,cart.original_amt,0) \
when 'WISH' then coalesce(wishlist.updated_amt,wishlist.original_amt,0) end price, \
case producttype when 'CART' then cart.create_dt \
when 'WISH' then wishlist.create_dt end effective_from, \
case status when 'LOW_INVENTORY' then 1 \
when 'BACK_IN_STOCK' THEN 2 \
when 'NOW_ON_SALE'then 3 \
else 4 end desired \
from (Select email_address,producttype,status,url,psize,pkey \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot INCLUDE NULLS ((producttype,status,url,psize) \
for pkey in ( (cw_sent_type_1,cw_status_change_msg_1,cw_product_url_1,cw_sku_size_1) as 1 \
,(cw_sent_type_2,cw_status_change_msg_2,cw_product_url_2,cw_sku_size_2) as 2 \
,(cw_sent_type_3,cw_status_change_msg_3,cw_product_url_3,cw_sku_size_3) as 3 \
,(cw_sent_type_4,cw_status_change_msg_4,cw_product_url_4,cw_sku_size_4) as 4))u) dataset \
left join emaildb.pers_cart_notification cart on cart.product_url = dataset.url \
and dataset.psize = cart.sku_size and producttype = 'CART' \
and dataset.email_address = cart.usa_email \
left join emaildb.pers_wishlist_notification wishlist on wishlist.product_url = dataset.url \
and dataset.psize = wishlist.sku_size and producttype = 'WISH' \
and dataset.email_address = wishlist.usa_email \
where coalesce(producttype,status,url,psize,'<NA>') != '<NA>' \
) TABA \
where producttype = 'CART')x \
where test_rank <> pkey - mpkey + 1

jcdp.feedCartWishlistWishlistSortingQuery =select DISTINCT email_address  from \
(select  email_address,producttype,status,psize, price, effective_from \
,desired \
,to_char(effective_from,'DD-Mon-YYYY HH24:MI') \
,pkey \
,rank() OVER(PARTITION BY email_address ORDER BY desired,to_date(to_char(effective_from,'DD-Mon-YYYY'),'DD-Mon-YYYY') desc,price desc,pkey asc) test_rank \
,min(pkey) over(partition by email_address,producttype) mpkey \
from \
(select email_address,producttype,status,url,psize,pkey, \
case producttype when 'CART' then coalesce(cart.updated_amt,cart.original_amt,0) \
when 'WISH' then coalesce(wishlist.updated_amt,wishlist.original_amt,0) end price, \
case producttype when 'CART' then cart.create_dt \
when 'WISH' then wishlist.create_dt end effective_from, \
case status when 'LOW_INVENTORY' then 1 \
when 'BACK_IN_STOCK' THEN 2 \
when 'NOW_ON_SALE'then 3 \
else 4 end desired \
from (Select email_address,producttype,status,url,psize,pkey \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot INCLUDE NULLS ((producttype,status,url,psize) \
for pkey in ( (cw_sent_type_1,cw_status_change_msg_1,cw_product_url_1,cw_sku_size_1) as 1 \
,(cw_sent_type_2,cw_status_change_msg_2,cw_product_url_2,cw_sku_size_2) as 2 \
,(cw_sent_type_3,cw_status_change_msg_3,cw_product_url_3,cw_sku_size_3) as 3 \
,(cw_sent_type_4,cw_status_change_msg_4,cw_product_url_4,cw_sku_size_4) as 4))u) dataset \
left join emaildb.pers_cart_notification cart on cart.product_url = dataset.url \
and dataset.psize = cart.sku_size and producttype = 'CART' \
and dataset.email_address = cart.usa_email \
left join emaildb.pers_wishlist_notification wishlist on wishlist.product_url = dataset.url \
and dataset.psize = wishlist.sku_size and producttype = 'WISH' \
and dataset.email_address = wishlist.usa_email \
where coalesce(producttype,status,url,psize,'<NA>') != '<NA>' \
) TABA \
where producttype = 'WISH')x \
where test_rank <> pkey - mpkey + 1

jcdp.feedCartWishlistLastImprDateQuery=Select email_address, url, psize from \
(select email_address,producttype,status,url,psize,pkey, \
case producttype when 'CART' then coalesce(cart.updated_amt,cart.original_amt,0) \
when 'WISH' then coalesce(wishlist.updated_amt,wishlist.original_amt,0) end price, \
case producttype when 'CART' then cart.create_dt \
when 'WISH' then wishlist.create_dt end effective_from, \
case producttype when 'CART' then cart.TRIG_LAST_IMPR_DT \
when 'WISH' then wishlist.TRIG_LAST_IMPR_DT end LastImpressionDate, \
case status when 'LOW_INVENTORY' then 1 \
when 'BACK_IN_STOCK' THEN 2 \
when 'NOW_ON_SALE'then 3 \
else 4 end desired \
from (Select email_address,producttype,status,url,psize,pkey \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot INCLUDE NULLS ((producttype,status,url,psize) \
for pkey in ( (cw_sent_type_1,cw_status_change_msg_1,cw_product_url_1,cw_sku_size_1) as 1 \
,(cw_sent_type_2,cw_status_change_msg_2,cw_product_url_2,cw_sku_size_2) as 2 \
,(cw_sent_type_3,cw_status_change_msg_3,cw_product_url_3,cw_sku_size_3) as 3 \
,(cw_sent_type_4,cw_status_change_msg_4,cw_product_url_4,cw_sku_size_4) as 4))u) dataset \
left join emaildb.pers_cart_notification cart on cart.product_url = dataset.url \
and dataset.psize = cart.sku_size and producttype = 'CART' \
and dataset.email_address = cart.usa_email \
left join emaildb.pers_wishlist_notification wishlist on wishlist.product_url = dataset.url \
and dataset.psize = wishlist.sku_size and producttype = 'WISH' \
and dataset.email_address = wishlist.usa_email \
where coalesce(producttype,status,url,psize,'<NA>') != '<NA>') TABA \
where LastImpressionDate > sysdate - 7

jcdp.feedPopularinYourAreaQuery=select email_address, pa_product_url_1, pa_product_url_2, pa_product_url_3,pa_image_url_1, pa_image_url_2, pa_image_url_3, pa_product_name_1, pa_product_name_1, pa_product_name_2, pa_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where pa_product_url_1 is null \
or pa_product_url_2 is null \
or pa_product_url_3 is null \
or pa_image_url_1 is null \
or pa_image_url_2 is null \
or pa_image_url_3 is null \
or pa_product_name_1 is null \
or pa_product_name_2 is null \
or pa_product_name_3 is null

jcdp.feedPopularItemValueOver25Query= Select email,product_description,style_cd,min_sale_price \
from emaildb.pers_popular_item \
where min_sale_price < 25 \
or min_sale_price is null
	
	
jcdp.feedPopularInYourAreaItemValueEndwith99Query= Select email,product_description,style_cd,min_sale_price \
from emaildb.pers_popular_item \
where mod(min_sale_price,1) = '0.99'

 
	
jcdp.feedPopularinYourAreaGenderPrefQuery=Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.pa_product_url_1, ST.pa_product_url_2, ST.pa_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.jc_kid_score = '1' \
and not ( \
(lower(ST.pa_product_url_1) like '%boys_category%' or lower(ST.pa_product_url_1) like '%girls_category%') \
or (lower(ST.pa_product_url_2) like '%boys_category%' or lower(ST.pa_product_url_2) like '%girls_category%') \
or (lower(ST.pa_product_url_3) like '%boys_category%' or lower(ST.pa_product_url_3) like '%girls_category%')) 


jcdp.feedPopularinYourAreaMenGenderQuery = Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.pa_product_url_1, ST.pa_product_url_2, ST.pa_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.jc_men_score = '1' \
and (lower(ST.pa_product_url_1) not like '%mens_category%' or lower(ST.pa_product_url_2) not like '%mens_category%' or lower(ST.pa_product_url_3) not like '%mens_category%')


jcdp.feedPopularinYourAreaWomenGenderQuery = Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.pa_product_url_1, ST.pa_product_url_2, ST.pa_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.jc_women_score = '1' \
and (lower(ST.pa_product_url_1) not like '%womens_category%' or lower(ST.pa_product_url_2) not like '%womens_category%' or lower(ST.pa_product_url_3) not like '%womens_category%')

jcdp.feedPopularinYourAreaWomenGenderNullQuery= Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.pa_product_url_1, ST.pa_product_url_2, ST.pa_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and (GDR.jc_men_score <>'1' and GDR.jc_women_score <> '1' and GDR.jc_kid_score <> '1') \
and (lower(ST.pa_product_url_1) not like '%womens_category%' or lower(ST.pa_product_url_2) not like '%womens_category%' or lower(ST.pa_product_url_3) not like '%womens_category%')


jcdp.feedPopularInYourAreaDupforAccountQuery1= Select email_address, PRODUCTURL, count(*) from \
(Select email_address, PRODUCTURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTURL for sk in (pa_product_url_1 as 1,pa_product_url_2 as 2,pa_product_url_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTURL \
having count(*) > 1

jcdp.feedPopularInYourAreaDupforAccountQuery2=Select email_address, IMAGETURL, count(*) from \
(Select email_address, IMAGETURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (IMAGETURL for sk in (pa_image_url_1 as 1,pa_image_url_2 as 2,pa_image_url_3 as 3)) \
) TAB1 \
group by email_address, IMAGETURL \
having count(*) > 1

jcdp.feedPopularInYourAreaDupforAccountQuery3=Select email_address, PRODUCTNAME, count(*) from \
(Select email_address, PRODUCTNAME \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTNAME for sk in (pa_product_name_1 as 1,pa_product_name_2 as 2,pa_product_name_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTNAME \
having count(*) > 1

jcdp.feedPopularInYourAreaNoFactoryURLQuery = select email_address, pa_product_url_1, pa_product_url_2, pa_product_url_3, pa_image_url_1,pa_image_url_2,  pa_image_url_3, pa_product_name_1, pa_product_name_2,  pa_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where lower(pa_product_url_1) like '%factory%' \
or lower(pa_product_url_2) like '%factory%' \
or lower(pa_product_url_3) like '%factory%' \
or lower(pa_image_url_1) like '%factory%' \
or lower(pa_image_url_2) like '%factory%' \
or lower(pa_image_url_3) like '%factory%'

jcdp.feedPopularInYourAreaPurchageProuductsExecludedQuery= Select distinct POT.email, POT.product_url, POT.image_url, POT.product_description, POT.product_id,PH.email,PH.product_id \
from emaildb.pers_popular_item POT \
join emaildb.pers_purchase_history PH \
on POT.email = PH.email \
and POT.product_id = PH.product_id

jcdp.feedNewlyAddedItem30DaysQuery = Select email,product_name,product_url, product_create_dt \
from emaildb.pers_newly_added_data_output \
where product_create_dt < sysdate - 30

jcdp.feedNewlyAddedItem45DaysQuery= Select email,product_url, product_create_dt \
from emaildb.pers_newly_added_hist \
where product_create_dt < sysdate -45
 
jcdp.feedNewlyAddedItemOver25Query = Select email,product_name,product_url, min_sale_price \
from emaildb.pers_newly_added_data_output \
where min_sale_price < 25 \
or min_sale_price is null

jcdp.feedNewlyAddedItemValueEndwith99Query = Select email,product_name,product_url, min_sale_price \
from emaildb.pers_newly_added_data_output \
where mod(min_sale_price,1) = '0.99'
 
jcdp.feedNewlyAddedEmailAdderss= select email_address, na_product_url_1, na_product_url_2, na_product_url_3 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where email_address is null

jcdp.FeedNewlyAddedNoNullFieldsQuery = select email_address, na_product_url_1, na_product_url_2, na_product_url_3, na_image_url_1,na_image_url_2,  na_image_url_3, na_product_name_1, na_product_name_2,  na_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where na_product_url_1 is null  \
or na_product_url_2 is null \
or na_product_url_3 is null \
or na_image_url_1 is null \
or na_image_url_2 is null \
or na_image_url_3 is null \
or na_product_name_1 is null \
or na_product_name_2 is null \
or na_product_name_3 is null 

jcdp.feedNewlyAddedNoFactoryURLQuery= select email_address, na_product_url_1, na_product_url_2, na_product_url_3, na_image_url_1,na_image_url_2,  na_image_url_3, na_product_name_1, na_product_name_2,  na_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where lower(na_product_url_1) like '%factory%' \
or lower(na_product_url_2) like '%factory%' \
or lower(na_product_url_3) like '%factory%' \
or lower(na_image_url_1) like '%factory%' \
or lower(na_image_url_2) like '%factory%' \
or lower(na_image_url_3) like '%factory%'



jcdp.feedNewlyAddedDupforAccountQuery1= Select email_address, PRODUCTURL, count(*) from \
(Select email_address, PRODUCTURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTURL for sk in (na_product_url_1 as 1,na_product_url_2 as 2,na_product_url_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTURL \
having count(*) > 1

jcdp.feedNewlyAddedDupforAccountQuery2=Select email_address, IMAGETURL, count(*) from \
(Select email_address, IMAGETURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (IMAGETURL for sk in (na_image_url_1 as 1,na_image_url_2 as 2,na_image_url_3 as 3)) \
) TAB1 \
group by email_address, IMAGETURL \
having count(*) > 1


jcdp.feedNewlyAddedDupforAccountQuery3=Select email_address, PRODUCTNAME, count(*) from \
(Select email_address, PRODUCTNAME \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTNAME for sk in (na_product_name_1 as 1,na_product_name_2 as 2,na_product_name_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTNAME \
having count(*) > 1


jcdp.feedTopratedminimumQuery=select email_address, tr_product_url_1, tr_product_url_2, tr_product_url_3, tr_image_url_1,tr_image_url_2,  tr_image_url_3, tr_product_name_1, tr_product_name_2,  tr_product_name_3 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where tr_product_url_1 is null \
or tr_product_url_2 is null \
or tr_product_url_3 is null \
or tr_image_url_1 is null \
or tr_image_url_2 is null \
or tr_image_url_3 is null \
or tr_product_name_1 is null \
or tr_product_name_2 is null \
or tr_product_name_3 is null

jcdp.feedTopRatedValueOver25Query = Select email,product_code, product_name, product_url, min_price \
from emaildb.pers_top_rated_output \
where min_price < 25 \
or min_price is null

jcdp.feedTopRatedItemValueEndwith99Query = Select email,product_code, product_name, product_url, min_price \
from emaildb.pers_top_rated_output \
where mod(min_price,1) = '0.99'


jcdp.feedTopratedMenGenderQuery = Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.tr_product_url_1, ST.tr_product_url_2, ST.tr_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.jc_men_score = '1' \
and (lower(ST.tr_product_url_1) not like '%mens_category%' or lower(ST.tr_product_url_2) not like '%mens_category%' or lower(ST.tr_product_url_3) not like '%mens_category%')


jcdp.feedTopratedWomenGenderQuery = Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.tr_product_url_1, ST.tr_product_url_2, ST.tr_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.jc_women_score = '1' \
and (lower(ST.tr_product_url_1) not like '%womens_category%' or lower(ST.tr_product_url_2) not like '%womens_category%' or lower(ST.tr_product_url_3) not like '%womens_category%')


jcdp.feedTopratedWomenGenderNullQuery=Select ST.email_address, GDR.jc_men_score,  GDR.jc_women_score, GDR.jc_kid_score, ST.tr_product_url_1, ST.tr_product_url_2, ST.tr_product_url_3 \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and (GDR.jc_men_score <>'1' and GDR.jc_women_score <> '1' and GDR.jc_kid_score <> '1') \
and (lower(ST.tr_product_url_1) not like '%womens_category%' or lower(ST.tr_product_url_2) not like '%womens_category%' or lower(ST.tr_product_url_3) not like '%womens_category%') \
and (lower(ST.tr_product_url_1) not like '%womens_category%' or lower(ST.tr_product_url_2) not like '%womens_category%' or lower(ST.tr_product_url_3) not like '%womens_category%')


jcdp.feedTopratedDupforAccountQuery1= Select email_address, PRODUCTURL, count(*) from \
(Select email_address, PRODUCTURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTURL for sk in (tr_product_url_1 as 1,tr_product_url_2 as 2,tr_product_url_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTURL \
having count(*) > 1

jcdp.feedTopratedDupforAccountQuery2=Select email_address, IMAGETURL, count(*) from \
(Select email_address, IMAGETURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (IMAGETURL for sk in (tr_image_url_1 as 1,tr_image_url_2 as 2,tr_image_url_3 as 3)) \
) TAB1 \
group by email_address, IMAGETURL \
having count(*) > 1


jcdp.feedTopratedDupforAccountQuery3=Select email_address, PRODUCTNAME, count(*) from \
(Select email_address, PRODUCTNAME \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTNAME for sk in (tr_product_name_1 as 1,tr_product_name_2 as 2,tr_product_name_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTNAME \
having count(*) > 1

jcdp.feedTopRatedNoFactoryURLQuery = select email_address, tr_product_url_1, tr_product_url_2, tr_product_url_3, tr_image_url_1,tr_image_url_2,  tr_image_url_3, tr_product_name_1, tr_product_name_2,  tr_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where lower(tr_product_url_1) like '%factory%' \
or lower(tr_product_url_2) like '%factory%' \
or lower(tr_product_url_3) like '%factory%' \
or lower(tr_image_url_1) like '%factory%' \
or lower(tr_image_url_2) like '%factory%' \
or lower(tr_image_url_3) like '%factory%'

jcdp.feedTopRatedPurchageProuductsExecludedQuery = Select distinct TOT.email, TOT.product_name, TOT.product_url, TOT.image_url, TOT.product_id,PH.email,PH.product_id \
from emaildb.pers_top_rated_output TOT \
join emaildb.pers_purchase_history PH \
on TOT.email = PH.email \
and TOT.product_id = PH.product_id

jcdp.browseproductminimumQuery = select email_address, br_product_url_1, br_product_url_2, br_product_url_3, \
br_image_url_1, br_image_url_2, br_image_url_3, \
br_product_name_1, br_product_name_2, br_product_name_3 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where (br_product_url_1 is not null or br_product_url_2 is not null or br_product_url_3 is not null or br_image_url_1 is not null or br_image_url_2 is not null or br_image_url_3 is not null or br_product_url_1 is not null or br_product_name_2 is not null or br_product_name_3 is not null) \
AND (br_product_url_1 is null or br_product_url_2 is null or br_product_url_3 is null or br_image_url_1 is null or br_image_url_2 is null or br_image_url_3 is null or br_product_name_1 is null or br_product_name_2 is null or br_product_name_3 is null )

jcdp.browseproductDupforAccountQuery1=Select email_address, PRODUCTURL, count(*) from \
(Select email_address, PRODUCTURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot (PRODUCTURL for sk in (br_product_url_1 as 1,br_product_url_2 as 2,br_product_url_3 as 3)) \
) TAB1 \
group by email_address, PRODUCTURL \
having count(*) > 1

jcdp.browseproductDupforAccountQuery2=Select email_address, ProductURL, ImageURL, count(*) from \
(Select email_address, ProductURL, ImageURL \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot ((ProductURL,ImageURL) for sk in ((br_product_url_1,br_image_url_1) as 1, \
(br_product_url_2,br_image_url_2) as 2, \
(br_product_url_3,br_image_url_3) as 3)) \
) TAB1 \
group by email_address, ProductURL,ImageURL \
having count(*) > 1


jcdp.browseproductDupforAccountQuery3=Select email_address, ProductURL, PRODUCTNAME, count(*) from \
(Select email_address, ProductURL, PRODUCTNAME \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
UnPivot ((ProductURL, PRODUCTNAME) for sk in ((br_product_url_1,br_product_name_1) as 1, \
(br_product_url_2,br_product_name_2) as 2, \
(br_product_url_3,br_product_name_3) as 3)) \
) TAB1 \
group by email_address, ProductURL, PRODUCTNAME \
having count(*) > 1

jcdp.feedBrowseProductPurchageProuductsExecludedQuery = Select distinct BOT.email, BOT.product_url, BOT.image_url, BOT.product_name, BOT.browsed_date, BOT.product_id,PH.email,PH.product_id \
from emaildb.pers_browse_data_output BOT \
join emaildb.pers_purchase_history PH \
on BOT.email = PH.email \
and BOT.product_id = PH.product_id

jcdp.feedBrowseProductNoFactoryURLQuery = select email_address, na_product_url_1, na_product_url_2, na_product_url_3, na_image_url_1,na_image_url_2,  na_image_url_3, na_product_name_1, na_product_name_2,  na_product_name_3 from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where lower(na_product_url_1) like '%factory%' \
or lower(na_product_url_2) like '%factory%' \
or lower(na_product_url_3) like '%factory%' \
or lower(na_image_url_1) like '%factory%' \
or lower(na_image_url_2) like '%factory%' \
or lower(na_image_url_3) like '%factory%'

jcdp.AMdeliverableemails = Select email_address from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where email_address not in (select email_address from emaildb.Mega_Deliverable_Email)

jcdp.AMDupProductURLQuery =Select email_address, URL, count(1) \
FROM \
(Select email_address,na_product_url_1, na_product_url_2, na_product_url_3, \
pa_product_url_1, pa_product_url_2, pa_product_url_3, \
tr_product_url_1,tr_product_url_2,tr_product_url_3, \
br_product_url_1,br_product_url_2, br_product_url_3, \
concat(cw_product_url_1,cw_sku_size_1) as cwurl1, concat(cw_product_url_2,cw_sku_size_2) as cwurl2, \
concat(cw_product_url_3,cw_sku_size_3) as cwurl3, concat(cw_product_url_4,cw_sku_size_4) as cwurl4 \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT) TABA \
UnPivot (URL for sk in (na_product_url_1 as 1, na_product_url_2 as 2, na_product_url_3 as 3, \
pa_product_url_1 as 4, pa_product_url_2 as 5, pa_product_url_3 as 6, \
tr_product_url_1 as 7,tr_product_url_2 as 8,tr_product_url_3 as 9, \
br_product_url_1 as 10,br_product_url_2 as 11, br_product_url_3 as 12, \
cwurl1 as 13, cwurl2 as 14, cwurl3 as 15, cwurl4 as 16)) \
group by email_address, URL \
having count(1) > 1

jcdp.AMUrlFormatfor5ModuleQuery = Select email_address, \
cw_product_url_1, cw_product_url_2, cw_product_url_3, cw_product_url_3,cw_product_url_4, \
na_product_url_1, na_product_url_2, na_product_url_3, \
pa_product_url_1, pa_product_url_2, pa_product_url_3, \
tr_product_url_1,tr_product_url_2,tr_product_url_3, \
br_product_url_1,br_product_url_2, br_product_url_3 \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where not \
(cw_product_url_1 like 'https://www.jcrew.com%' and cw_product_url_2  like 'https://www.jcrew.com%' and cw_product_url_3  like 'https://www.jcrew.com%' and cw_product_url_4  like 'https://www.jcrew.com%' and \
na_product_url_1 like 'https://www.jcrew.com%' and na_product_url_2 like 'https://www.jcrew.com%' and na_product_url_3 like 'https://www.jcrew.com%'and \
pa_product_url_1 like 'https://www.jcrew.com%' and pa_product_url_2 like 'https://www.jcrew.com%' and pa_product_url_3 like 'https://www.jcrew.com%' and \
tr_product_url_1 like 'https://www.jcrew.com%' and tr_product_url_2 like 'https://www.jcrew.com%' and tr_product_url_3 like 'https://www.jcrew.com%' and \
br_product_url_1 like 'https://www.jcrew.com%' and br_product_url_2 like 'https://www.jcrew.com%' and br_product_url_3  like 'https://www.jcrew.com%')


jcdp.AMIMGUrlFormatfor5ModuleQuery = Select email_address, \
cw_image_url_1, cw_image_url_2, cw_image_url_3, cw_image_url_3,cw_image_url_4, \
na_image_url_1, na_image_url_2, na_image_url_3, \
pa_image_url_1, pa_image_url_2, pa_image_url_3, \
tr_image_url_1,tr_image_url_2,tr_image_url_3, \
br_image_url_1,br_image_url_2, br_image_url_3 \
FROM emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where not \
(cw_image_url_1 like 'https://%/image/%' and cw_image_url_2  like 'https://%/image/%' and cw_image_url_3  like 'https://%/image/%' and cw_image_url_4  like 'https://%/image/%' and \
na_image_url_1 like 'https://%/image/%' and na_image_url_2 like 'https://%/image/%' and na_image_url_3 like 'https://%/image/%'and \
pa_image_url_1 like 'https://%/image/%' and pa_image_url_2 like 'https://%/image/%' and pa_image_url_3 like 'https://%/image/%' and \
tr_image_url_1 like 'https://%/image/%' and tr_image_url_2 like 'https://%/image/%' and tr_image_url_3 like 'https://%/image/%' and \
br_image_url_1 like 'https://%/image/%' and br_image_url_2 like 'https://%/image/%' and br_image_url_3  like 'https://%/image/%')



jcdp.AMUSLocationQuery=  Select ST.email_address, GDR.country_cd \
From emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT ST, emaildb.jcg_email_addresses GDR \
where st.email_address = GDR.email_address \
and GDR.country_cd <> 'US'

jcdp.imagebrowsebyquery =select email_address,URL,ProductName from \
(select email_address ,br_image_url_1,br_image_url_2, br_image_url_3, br_product_name_1, br_product_name_2, br_product_name_3 from \
(select email_address ,br_image_url_1,br_image_url_2, br_image_url_3, br_product_name_1, br_product_name_2, br_product_name_3 , \
ROW_NUMBER()over(partition by br_image_url_1,br_image_url_2, br_image_url_3 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where ((br_image_url_1 is not NULL) and (br_image_url_2 is not null) and (br_image_url_3 is not null)) ) t \
WHERE t.rno =1 and rownum < 6) t2 \
UnPivot((URL,ProductName) for sk in ((br_image_url_1,br_product_name_1) as 1,(br_image_url_2,br_product_name_2) as 2,(br_image_url_3,br_product_name_3) as 3)) order by email_address, sk 


jcdp.imagenewlyaddedquery =select email_address,URL,ProductName from \
(select email_address ,na_image_url_1,na_image_url_2, na_image_url_3, na_product_name_1, na_product_name_2, na_product_name_3 from \
(select email_address ,na_image_url_1,na_image_url_2, na_image_url_3, na_product_name_1, na_product_name_2, na_product_name_3 , \
ROW_NUMBER()over(partition by na_image_url_1,na_image_url_2, na_image_url_3 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where ((na_image_url_1 is not NULL) and (na_image_url_2 is not null) and (na_image_url_3 is not null)) ) t \
WHERE t.rno =1 and rownum < 6) t2 \
UnPivot((URL,ProductName) for sk in ((na_image_url_1,na_product_name_1) as 1,(na_image_url_2,na_product_name_2) as 2,(na_image_url_3,na_product_name_3) as 3)) order by email_address, sk

jcdp.imagefamousareaquery= select email_address,URL,ProductName from \
(select email_address ,pa_image_url_1,pa_image_url_2, pa_image_url_3, pa_product_name_1, pa_product_name_2, pa_product_name_3 from \
(select email_address ,pa_image_url_1,pa_image_url_2, pa_image_url_3, pa_product_name_1, pa_product_name_2, pa_product_name_3 , \
ROW_NUMBER()over(partition by pa_image_url_1,pa_image_url_2, pa_image_url_3 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where ((pa_image_url_1 is not NULL) and (pa_image_url_2 is not null) and (pa_image_url_3 is not null)) ) t \
WHERE t.rno =1 and rownum < 6) t2 \
UnPivot((URL,ProductName) for sk in ((pa_image_url_1,pa_product_name_1) as 1,(pa_image_url_2,pa_product_name_2) as 2,(pa_image_url_3,pa_product_name_3) as 3)) order by email_address, sk


jcdp.imagetopratedquery =select email_address,URL,ProductName from \
(select email_address ,tr_image_url_1,tr_image_url_2, tr_image_url_3, tr_product_name_1, tr_product_name_2, tr_product_name_3 from \
(select email_address ,tr_image_url_1,tr_image_url_2, tr_image_url_3, tr_product_name_1, tr_product_name_2, tr_product_name_3 , \
ROW_NUMBER()over(partition by tr_image_url_1,tr_image_url_2, tr_image_url_3 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where ((tr_image_url_1 is not NULL) and (tr_image_url_2 is not null) and (tr_image_url_3 is not null)) ) t \
WHERE t.rno =1 and rownum < 6) t2 \
UnPivot((URL,ProductName) for sk in ((tr_image_url_1,tr_product_name_1) as 1,(tr_image_url_2,tr_product_name_2) as 2,(tr_image_url_3,tr_product_name_3) as 3)) order by email_address, sk


jcdp.imagecartwishlistquery  = select email_address,URL,ProductName from \
(select email_address ,cw_image_url_1,cw_image_url_2, cw_image_url_3, cw_image_url_4, cw_short_description_1, cw_short_description_2, cw_short_description_3, cw_short_description_4 from \
(select email_address ,cw_image_url_1,cw_image_url_2, cw_image_url_3, cw_image_url_4, cw_short_description_1, cw_short_description_2, cw_short_description_3 ,cw_short_description_4, \
ROW_NUMBER()over(partition by cw_image_url_1,cw_image_url_2, cw_image_url_3,cw_image_url_4 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT \
where ((cw_image_url_1 is not NULL) and (cw_image_url_2 is not null) and (cw_image_url_3 is not null) and (cw_image_url_4 is not null)) ) t \
WHERE t.rno =1 and rownum < 6) t2 \
UnPivot((URL,ProductName) for sk in ((cw_image_url_1,cw_short_description_1) as 1,(cw_image_url_2,cw_short_description_2) as 2,(cw_image_url_3,cw_short_description_3) as 3, (cw_image_url_4,cw_short_description_4) as 4)) order by email_address, sk


jcdp.shoppingbagquery = Select email_address,URL, productname from \
(select distinct email_address,URL,'product name' as productname from \
(select email_address ,cw_user_url_1,cw_user_url_2, cw_user_url_3, cw_user_url_4, cw_short_description_1, cw_short_description_2, cw_short_description_3, cw_short_description_4 from \
(select email_address ,cw_user_url_1,cw_user_url_2, cw_user_url_3, cw_user_url_4, cw_short_description_1, cw_short_description_2, cw_short_description_3, cw_short_description_4, \
ROW_NUMBER()over(partition by cw_user_url_1,cw_user_url_2, cw_user_url_3, cw_user_url_4 order by email_address) rno \
from emaildb.V_PERS_MEGA_ALL_MODULES_OUTPUT where ((cw_user_url_1 is not NULL) and (cw_user_url_2 is not null) and (cw_user_url_3 is not null) and (cw_user_url_4 is not null)) ) t \
WHERE t.rno =1 and rownum < 500) t2 \
UnPivot((URL,ProductName) for sk in \
((cw_user_url_1,cw_short_description_1) as 1, \
(cw_user_url_2,cw_short_description_2) as 2, \
(cw_user_url_3,cw_short_description_3) as 3, \
(cw_user_url_4,cw_short_description_4) as 4)) \
where lower(URL) like 'https://www.jcrew.com/bag%') final \
where rownum <= 25


# conditional shipping method retrieval queries
conditionalShippingMethod.overnight=select distinct case \
when shipmethod_name like '%NEXTDAYAIR%' Then 'overnight' \
end ShippingMethod \
from schema_CUSTOM.JC_SHIPMETHODS_CUTOFF \
where shipmethod_name not like '%FACTORY%' \
and active = 'A' \
and shipmethod_name like '%NEXTDAYAIR%' \
and (to_char(sysdate, 'HH24') >= start_time and to_char(sysdate, 'HH24') < end_time + 1)

conditionalShippingMethod.saturday=select distinct case \
when shipmethod_name='UPS_SATD' Then 'saturday' \
end ShippingMethod \
from schema_CUSTOM.JC_SHIPMETHODS_CUTOFF \
where shipmethod_name not like '%FACTORY' \
and active = 'A' \
and shipmethod_name like '%SATD%' \
and ( \
(to_char(sysdate, 'D') = START_DAY and to_char(sysdate, 'HH24') >= start_time) \
or \
(to_char(sysdate, 'D') = END_DAY and to_char(sysdate, 'HH24') < end_time + 1) \
or \
(to_char(sysdate, 'D') > start_day and to_char(sysdate, 'D') < END_DAY) \
)