package com.jcrew.page;import com.jcrew.pojo.Country;import com.jcrew.pojo.Product;import com.jcrew.utils.StateHolder;import com.jcrew.utils.Util;import org.apache.commons.lang.StringEscapeUtils;import org.openqa.selenium.By;import org.openqa.selenium.JavascriptExecutor;import org.openqa.selenium.NoSuchElementException;import org.openqa.selenium.WebDriver;import org.openqa.selenium.WebElement;import org.openqa.selenium.support.FindBy;import org.openqa.selenium.support.PageFactory;import org.openqa.selenium.support.ui.ExpectedConditions;import org.openqa.selenium.support.ui.WebDriverWait;import java.util.List;/** * Created by ravi kumar on 3/13/17. */public class Wishlist {    private final WebDriver driver;    private final WebDriverWait wait;    private final HeaderWrap header;    private final StateHolder stateHolder = StateHolder.getInstance();    @FindBy(id = "userWishlist")    private WebElement wishlist;    @FindBy(id = "wishlistName")    private WebElement wishlistName;    @FindBy(id = "userWishlist")    private WebElement userWishlist;    public Wishlist(WebDriver driver) {        this.driver = driver;        wait = Util.createWebDriverWait(driver);        PageFactory.initElements(driver, this);        Util.waitForPageFullyLoaded(driver);        wait.until(ExpectedConditions.visibilityOf(wishlistName));        header = new HeaderWrap(driver);    }    public boolean isWishList() {        Country country = (Country) stateHolder.get("context");        boolean isURLPattern = Util.countryContextURLCompliance(driver, country, "/wishlist/");        return wishlistName.isDisplayed();    }    public boolean verifyProductInWishlist(String expectedProductName){        String Prodname;        Util.createWebDriverWait(driver).until(ExpectedConditions.visibilityOf(userWishlist));        List<WebElement> productsInWishlist = userWishlist.findElements(By.className("item-data"));        for(WebElement wishElement:productsInWishlist){            Prodname = wishElement.getAttribute("data-itemtitle").toLowerCase();            Prodname = StringEscapeUtils.unescapeHtml(Prodname);            Prodname = Prodname.replace("pre-order ","");            if(expectedProductName.equalsIgnoreCase(Prodname)){                return true;            }        }        return false;    }    public void delete_current_products() {        Util.waitForPageFullyLoaded(driver);        JavascriptExecutor executor = (JavascriptExecutor) driver;        executor.executeScript(                "var params = $.parseJSON(globalObj.wishlist.itemsArrayJson).header;" +                        "params.deleteItems = params.sortOrder;" +                        "$.ajax({ url: \"/userwishlist/ajax/wishlist_ajax_update.jsp\",\n" +                        "         dataType: \"json\"," +                        "         data: params" +                        "});"        );    }        public Product getWishlistItem(String itemCode) {        Product wishlistItem = null;        List<WebElement> wishlistItems = wishlist.findElements(By.xpath(".//div[@data-product-code='" + itemCode + "']"));        if (wishlistItems.size() > 0) {            WebElement item = wishlistItems.get(0);            wishlistItem = new Product();            String name = item.getAttribute("data-itemtitle");            name = StringEscapeUtils.unescapeHtml(name);            wishlistItem.setName(name);            wishlistItem.setColor(item.getAttribute("data-color"));            wishlistItem.setSize(item.getAttribute("data-size"));        }        return wishlistItem;    }        public int getItemNumber() {        try {            List<WebElement> items = wishlist.findElements(By.xpath(".//li[@class='wishlist-items']"));            return items.size();        } catch (NoSuchElementException noWishlist) {            return 0;        }    }        }